<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>R: Quote vs Substitute | Siddharth&#39;s Blog</title>
<meta name="keywords" content="Programming, R">
<meta name="description" content="What is the difference between the following 2 code blocks, even though they produce the same output? If you are not sure, this post will help you.
rm(list=ls()) x &lt;- 1:1e8 g &lt;- function(a){ b &lt;- substitute(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e&#43;07 [1] 5e&#43;07 rm(list=ls()) x &lt;- 1:1e8 g &lt;- function(a){ b &lt;- quote(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e&#43;07 [1] 5e&#43;07 One of the really (really) cool features of R is the idea of Non Standard Evaluation.">
<meta name="author" content="">
<link rel="canonical" href="https://subsid.github.io/posts/2018-01-18-r-quote-vs-substitute/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.998b0f67f24082ae79900674259f89272fd2b7c4eb44357dfcfebcb73156aae1.css" integrity="sha256-mYsPZ/JAgq55kAZ0JZ&#43;JJy/St8TrRDV9/P68tzFWquE=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://subsid.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://subsid.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://subsid.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://subsid.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://subsid.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://subsid.github.io/posts/2018-01-18-r-quote-vs-substitute/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4H9QYNJZV1"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-4H9QYNJZV1', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="R: Quote vs Substitute" />
<meta property="og:description" content="What is the difference between the following 2 code blocks, even though they produce the same output? If you are not sure, this post will help you.
rm(list=ls()) x &lt;- 1:1e8 g &lt;- function(a){ b &lt;- substitute(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e&#43;07 [1] 5e&#43;07 rm(list=ls()) x &lt;- 1:1e8 g &lt;- function(a){ b &lt;- quote(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e&#43;07 [1] 5e&#43;07 One of the really (really) cool features of R is the idea of Non Standard Evaluation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://subsid.github.io/posts/2018-01-18-r-quote-vs-substitute/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-18T14:21:16-05:00" />
<meta property="article:modified_time" content="2018-01-18T14:21:16-05:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="R: Quote vs Substitute"/>
<meta name="twitter:description" content="What is the difference between the following 2 code blocks, even though they produce the same output? If you are not sure, this post will help you.
rm(list=ls()) x &lt;- 1:1e8 g &lt;- function(a){ b &lt;- substitute(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e&#43;07 [1] 5e&#43;07 rm(list=ls()) x &lt;- 1:1e8 g &lt;- function(a){ b &lt;- quote(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e&#43;07 [1] 5e&#43;07 One of the really (really) cool features of R is the idea of Non Standard Evaluation."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://subsid.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "R: Quote vs Substitute",
      "item": "https://subsid.github.io/posts/2018-01-18-r-quote-vs-substitute/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "R: Quote vs Substitute",
  "name": "R: Quote vs Substitute",
  "description": "What is the difference between the following 2 code blocks, even though they produce the same output? If you are not sure, this post will help you.\nrm(list=ls()) x \u0026lt;- 1:1e8 g \u0026lt;- function(a){ b \u0026lt;- substitute(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e+07 [1] 5e+07 rm(list=ls()) x \u0026lt;- 1:1e8 g \u0026lt;- function(a){ b \u0026lt;- quote(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e+07 [1] 5e+07 One of the really (really) cool features of R is the idea of Non Standard Evaluation.",
  "keywords": [
    "Programming", "R"
  ],
  "articleBody": " What is the difference between the following 2 code blocks, even though they produce the same output? If you are not sure, this post will help you.\nrm(list=ls()) x \u003c- 1:1e8 g \u003c- function(a){ b \u003c- substitute(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e+07 [1] 5e+07 rm(list=ls()) x \u003c- 1:1e8 g \u003c- function(a){ b \u003c- quote(a) print(eval(b)) print(eval(b)) } g(mean(x)) [1] 5e+07 [1] 5e+07 One of the really (really) cool features of R is the idea of Non Standard Evaluation.\nCapturing expressions with substitute. Function arguments in R are evaluated lazily. Hadley's book explains this in the context of R, if you want to learn more about the advantages and the idea in general, I recommend these readings in haskellâ€‹ and clojure.\nIn R, function arguments are evaluated only if they're used.\nf \u003c- function(x) { 10 } f(stop(\"This is an error!\")) ## [1] 10 At an implementation level, this means that the argument passed to f is not a value, it's a special type of object called promise. The advantage of this, is that we have access, not only to the final value, but also to the expression that computes it.\nWe can capture this expression using the substitute command and then evaluate it with eval.\nf \u003c- function(x) { print(x) print(substitute(x)) print(eval(substitute(x))) } f(10 * 5 + 2) ## [1] 52 ## 10 * 5 + 2 ## [1] 52 What about quote? Let's see.\nf \u003c- function(x) { print(x) print(quote(x)) print(eval(quote(x))) } f(10 * 5 + 2) [1] 52 x [1] 52 Interesting! In this case, we don't see the expression 10 * 5 + 2, but we see the variable x. In other words, quote captures its input as is. In this case, it just captures the promise.\nHow is this useful? quote let's us capture variables that are not bound to anything in the environment yet. We can capture it, and later evaluate it, when the environment has a value for it.\nf \u003c- function(x) { print(x) a \u003c- 10 b \u003c- 20 print(eval(x)) } f(quote(a * b + 5)) a and b were not defined when the function was called, but using quote we can still call the function!\nSo how does this work in our initial example? Since, substitute captures the expression, it has to reevaluate it everytime its called, but in case of quote, it evaluates it only once! (As the promise gets resolved the first time its called, and then just gets looked up) We can easily see this with some profiling.\nrm(list=ls()) time \u003c- function(expr) { start \u003c- proc.time() expr print(proc.time() - start) } x \u003c- 1:1e8 g \u003c- function(a){ ## substitute print(\"substitute\") time(print(eval(substitute(a)))) time(print(eval(substitute(a)))) print(\"quote\") ## quote time(print(eval(quote(a)))) time(print(eval(quote(a)))) } g(mean(x)) [1] \"substitute\" [1] 5e+07 user system elapsed 0.094 0.000 0.094 [1] 5e+07 user system elapsed 0.092 0.000 0.091 [1] \"quote\" [1] 5e+07 user system elapsed 0.103 0.000 0.103 [1] 5e+07 user system elapsed 0 0 0 References Hadley's Advanced R Stat Computing course by James Long Blog:R Quote vs Substitute Programming Languages Blog\n",
  "wordCount" : "504",
  "inLanguage": "en",
  "datePublished": "2018-01-18T14:21:16-05:00",
  "dateModified": "2018-01-18T14:21:16-05:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://subsid.github.io/posts/2018-01-18-r-quote-vs-substitute/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Siddharth's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://subsid.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://subsid.github.io/" accesskey="h" title="Siddharth&#39;s Blog (Alt + H)">Siddharth&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://subsid.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://subsid.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://subsid.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://subsid.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://subsid.github.io/index.xml" title="RSS">
                    <span>RSS</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      R: Quote vs Substitute
    </h1>
    <div class="post-meta"><span title='2018-01-18 14:21:16 -0500 EST'>January 18, 2018</span>

</div>
  </header> 
  <div class="post-content">
<div id="outline-container-headline-1" class="outline-4">
<h4 id="headline-1">
What is the difference between the following 2 code blocks, even though they produce the same output?
</h4>
<div id="outline-text-headline-1" class="outline-text-4">
<p>
If you are not sure, this post will help you.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">rm</span>(list<span style="color:#f92672">=</span><span style="color:#a6e22e">ls</span>())
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1e8</span>
</span></span><span style="display:flex;"><span>g <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(a){
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">substitute</span>(a)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(b))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(b))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">g</span>(<span style="color:#a6e22e">mean</span>(x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span></span></span></code></pre></div>
</div>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">rm</span>(list<span style="color:#f92672">=</span><span style="color:#a6e22e">ls</span>())
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1e8</span>
</span></span><span style="display:flex;"><span>g <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(a){
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">quote</span>(a)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(b))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(b))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">g</span>(<span style="color:#a6e22e">mean</span>(x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span></span></span></code></pre></div>
</div>
<p>
One of the really (really) cool features of R is the idea of <a href="http://adv-r.had.co.nz/Computing-on-the-language.html">Non Standard Evaluation</a>.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-4">
<h4 id="headline-2">
Capturing expressions with <strong>substitute</strong>.
</h4>
<div id="outline-text-headline-2" class="outline-text-4">
<p>
Function arguments in R are evaluated <a href="https://en.wikipedia.org/wiki/Lazy_evaluation">lazily</a>. <a href="http://adv-r.had.co.nz/Functions.html#function-arguments">Hadley&#39;s book</a> explains this in the context of R, if you want to learn more about the advantages and the idea in general, I recommend these readings in <a href="https://www.schoolofhaskell.com/school/starting-with-haskell/introduction-to-haskell/6-laziness">haskellâ€‹</a> and <a href="http://clojure-doc.org/articles/language/laziness.html">clojure</a>.</p>
<p>
In R, <strong>function arguments are evaluated only if they&#39;re used.</strong></p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>f <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(x) {
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">stop</span>(<span style="color:#e6db74">&#34;This is an error!&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 10</span></span></span></code></pre></div>
</div>
<p>
At an implementation level, this means that the argument passed to <code>f</code> is not a <strong>value</strong>, it&#39;s a special type of object called <strong><strong>promise</strong></strong>. The advantage of this, is that we have access, not only to the <strong><strong>final value</strong></strong>, but also to the expression that <strong><strong>computes it</strong></strong>.</p>
<p>
We can capture this <strong><strong>expression</strong></strong> using the <code>substitute</code> command and then evaluate it with <code>eval</code>.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>f <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(x) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(x)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">substitute</span>(x))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">substitute</span>(x)))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">f</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 52</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 10 * 5 + 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## [1] 52</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-3" class="outline-4">
<h4 id="headline-3">
What about <strong>quote</strong>?
</h4>
<div id="outline-text-headline-3" class="outline-text-4">
<p>Let&#39;s see.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>f <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(x) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(x)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">quote</span>(x))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">quote</span>(x)))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">f</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>x
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">52</span></span></span></code></pre></div>
</div>
<p>
Interesting! In this case, we don&#39;t see the <strong>expression</strong> <code>10 * 5 + 2</code>, but we see the variable <code>x</code>. In other words, quote captures its input <strong>as is</strong>. In this case, it just captures the <strong>promise</strong>.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-4">
<h4 id="headline-4">
How is this useful?
</h4>
<div id="outline-text-headline-4" class="outline-text-4">
<p>
<code>quote</code> let&#39;s us capture variables that are not bound to anything in the environment yet. We can capture it, and later evaluate it, when the environment has a value for it.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>f <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(x) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(x)
</span></span><span style="display:flex;"><span>  a <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  b <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(x))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">quote</span>(a <span style="color:#f92672">*</span> b <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>))</span></span></code></pre></div>
</div>
<p>
<code>a</code> and <code>b</code> were not defined when the function was called, but using <code>quote</code> we can still call the function!</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-4">
<h4 id="headline-5">
So how does this work in our initial example?
</h4>
<div id="outline-text-headline-5" class="outline-text-4">
<p>
Since, substitute captures the <strong>expression</strong>, it has to <strong>reevaluate</strong> it everytime its called, but in case of <strong>quote</strong>, it evaluates it only once! (As the promise gets <strong>resolved</strong> the first time its called, and then just gets looked up) We can easily see this with some profiling.</p>
<div class="src src-r">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">rm</span>(list<span style="color:#f92672">=</span><span style="color:#a6e22e">ls</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>time <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(expr) {
</span></span><span style="display:flex;"><span>  start <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">proc.time</span>()
</span></span><span style="display:flex;"><span>  expr
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">proc.time</span>() <span style="color:#f92672">-</span> start)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1e8</span>
</span></span><span style="display:flex;"><span>g <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(a){
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## substitute</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;substitute&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>(<span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">substitute</span>(a))))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>(<span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">substitute</span>(a))))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;quote&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## quote</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>(<span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">quote</span>(a))))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>(<span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">quote</span>(a))))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">g</span>(<span style="color:#a6e22e">mean</span>(x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;substitute&#34;</span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span>
</span></span><span style="display:flex;"><span>   user  system elapsed 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0.094</span>   <span style="color:#ae81ff">0.000</span>   <span style="color:#ae81ff">0.094</span> 
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span>
</span></span><span style="display:flex;"><span>   user  system elapsed 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0.092</span>   <span style="color:#ae81ff">0.000</span>   <span style="color:#ae81ff">0.091</span> 
</span></span><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;quote&#34;</span>
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span>
</span></span><span style="display:flex;"><span>   user  system elapsed 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0.103</span>   <span style="color:#ae81ff">0.000</span>   <span style="color:#ae81ff">0.103</span> 
</span></span><span style="display:flex;"><span>[1] <span style="color:#ae81ff">5e+07</span>
</span></span><span style="display:flex;"><span>   user  system elapsed 
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">0</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-4">
<h4 id="headline-6">
References
</h4>
<div id="outline-text-headline-6" class="outline-text-4">
<ul>
<li><a href="http://adv-r.had.co.nz/">Hadley&#39;s Advanced R</a></li>
<li><a href="https://longjp.github.io/statcomp/">Stat Computing</a> course by <a href="http://www.stat.tamu.edu/~jlong/">James Long</a></li>
</ul>
</div>
</div>
<div id="outline-container-hideroamtags" class="outline-2">
<h2 id="hideroamtags">
Blog:R Quote vs Substitute
</h2>
<div id="outline-text-hideroamtags" class="outline-text-2">
<p><a href="id:55f23bfb-af86-47f1-ba37-e0671d409350">Programming Languages</a> <a href="id:145967c8-ebfc-41c6-97ed-d9b7b8a6b415">Blog</a></p>
</div>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://subsid.github.io/tags/programming/">Programming</a></li>
      <li><a href="https://subsid.github.io/tags/r/">R</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://subsid.github.io/">Siddharth&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>


<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
